<div class="dashboard-container">
  <header>
    <h1>Admin Dashboard</h1>
    <a href="/admin/logout" class="btn">Logout</a>
  </header>

  <section class="user-section">
    <h2>Manage Users</h2>
    <div class="toolbar">
      <button class="btn" onclick="openAddUserModal()">+ Add User</button>
      <input type="text" id="searchBox" placeholder="Search users..." onkeyup="searchUsers()">
    </div>
    <table id="userTable">
      <thead>
        <tr>
          <th>#</th>
          <th>Username</th>
          <th>Email</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {{#each users}}
        <tr>
          <td>{{inc @index}}</td>
          <td>{{this.username}}</td>
          <td>{{this.email}}</td>
          <td>
            <button class="btn edit" onclick="openEditUserModal('{{this._id}}','{{this.username}}','{{this.email}}')">Edit</button>
            <button class="btn delete" onclick="openDeleteUserModal('{{this._id}}')">Delete</button>
          </td>
        </tr>
        {{/each}}
      </tbody>
    </table>
  </section>
</div>

<!-- Add User Modal -->
<div id="addUserModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeAddUserModal()">&times;</span>
    <h2>Add User</h2>
    <form action="/admin/addUser" method="POST">
      <label for="username">Username</label>
      <input type="text" id="username" name="username" required>

      <label for="email">Email</label>
      <input type="email" id="email" name="email" required>

      <label for="password">Password</label>
      <input type="password" id="password" name="password" required>

      <button type="submit" class="btn">Add User</button>
    </form>
  </div>
</div>

<!-- Edit User Modal -->
<div id="editUserModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeEditUserModal()">&times;</span>
    <h2>Edit User</h2>
    <form id="editUserForm" action="/admin/editUser" method="POST">
      <input type="hidden" id="editUserId" name="id">
      
      <label for="editUsername">Username</label>
      <input type="text" id="editUsername" name="username" required>

      <label for="editEmail">Email</label>
      <input type="email" id="editEmail" name="email" required>

      <button type="submit" class="btn">Save Changes</button>
    </form>
  </div>
</div>

<!-- Delete User Modal -->
<div id="deleteUserModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeDeleteUserModal()">&times;</span>
    <h2>Delete User</h2>
    <p>Are you sure you want to delete this user?</p>
    <form id="deleteUserForm" action="/admin/deleteUser" method="POST">
      <input type="hidden" id="deleteUserId" name="id">
      <button type="submit" class="btn delete">Yes, Delete</button>
    </form>
  </div>
</div>

<script>
  // Search filter
  function searchUsers() {
    let input = document.getElementById("searchBox").value.toLowerCase();
    let rows = document.querySelectorAll("#userTable tbody tr");

    rows.forEach(row => {
      let username = row.cells[1].textContent.toLowerCase();
      let email = row.cells[2].textContent.toLowerCase();
      row.style.display = (username.includes(input) || email.includes(input)) ? "" : "none";
    });
  }

  // Add User Modal
  function openAddUserModal() {
    document.getElementById("addUserModal").style.display = "block";
  }
  function closeAddUserModal() {
    document.getElementById("addUserModal").style.display = "none";
  }

  // Edit User Modal
  function openEditUserModal(id, username, email) {
    document.getElementById("editUserId").value = id;
    document.getElementById("editUsername").value = username;
    document.getElementById("editEmail").value = email;
    document.getElementById("editUserModal").style.display = "block";
  }
  function closeEditUserModal() {
    document.getElementById("editUserModal").style.display = "none";
  }

  // Delete User Modal
  function openDeleteUserModal(id) {
    document.getElementById("deleteUserId").value = id;
    document.getElementById("deleteUserModal").style.display = "block";
  }
  function closeDeleteUserModal() {
    document.getElementById("deleteUserModal").style.display = "none";
  }
</script>
